!function(){var ot=[].indexOf,st={}.hasOwnProperty,t=function(tt){var et,l,t,r=function(t,e,r){for(var n=(t=(t+="").split("."))[0],r=1<t.length?r+t[1]:"",a=/(\d+)(\d{3})/;a.test(n);)n=n.replace(a,"$1"+e+"$2");return n+r},e=function(e){return e=tt.extend({},{digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:""},e),function(t){return isNaN(t)||!isFinite(t)?"":(t=r((e.scaler*t).toFixed(e.digitsAfterDecimal),e.thousandsSep,e.decimalSep),""+e.prefix+t+e.suffix)}},n=e(),s=e({digitsAfterDecimal:0}),i=e({digitsAfterDecimal:1,scaler:100,suffix:"%"}),u={count:function(n=s){return function(){return function(t,e,r){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:n}}}},uniques:function(a,o=s){return function([n]){return function(t,e,r){return{uniq:[],push:function(t){var e=t[n];if(ot.call(this.uniq,e)<0)return this.uniq.push(t[n])},value:function(){return a(this.uniq)},format:o,numInputs:null!=n?0:1}}}},sum:function(a=n){return function([n]){return function(t,e,r){return{sum:0,push:function(t){if(!isNaN(parseFloat(t[n])))return this.sum+=parseFloat(t[n])},value:function(){return this.sum},format:a,numInputs:null!=n?0:1}}}},extremes:function(a,o=n){return function([n]){return function(t,e,r){return{val:null,sorter:nt(null!=t?t.sorters:void 0,n),push:function(t){var e,t=t[n];if("min"!==a&&"max"!==a||(t=parseFloat(t),isNaN(t))||(this.val=Math[a](t,null!=(e=this.val)?e:t)),"first"===a&&this.sorter(t,null!=(e=this.val)?e:t)<=0&&(this.val=t),"last"===a&&0<=this.sorter(t,null!=(e=this.val)?e:t))return this.val=t},value:function(){return this.val},format:function(t){return isNaN(t)?t:o(t)},numInputs:null!=n?0:1}}}},quantile:function(a,o=n){return function([n]){return function(t,e,r){return{vals:[],push:function(t){t=parseFloat(t[n]);if(!isNaN(t))return this.vals.push(t)},value:function(){var t;return 0===this.vals.length?null:(this.vals.sort(function(t,e){return t-e}),t=(this.vals.length-1)*a,(this.vals[Math.floor(t)]+this.vals[Math.ceil(t)])/2)},format:o,numInputs:null!=n?0:1}}}},runningStat:function(a="mean",o=1,s=n){return function([n]){return function(t,e,r){return{n:0,m:0,s:0,push:function(t){var e,t=parseFloat(t[n]);if(!isNaN(t))return this.n+=1,1===this.n?this.m=t:(e=this.m+(t-this.m)/this.n,this.s=this.s+(t-this.m)*(t-e),this.m=e)},value:function(){if("mean"===a)return 0===this.n?NaN:this.m;if(this.n<=o)return 0;switch(a){case"var":return this.s/(this.n-o);case"stdev":return Math.sqrt(this.s/(this.n-o))}},format:s,numInputs:null!=n?0:1}}}},sumOverSum:function(o=n){return function([n,a]){return function(t,e,r){return{sumNum:0,sumDenom:0,push:function(t){if(isNaN(parseFloat(t[n]))||(this.sumNum+=parseFloat(t[n])),!isNaN(parseFloat(t[a])))return this.sumDenom+=parseFloat(t[a])},value:function(){return this.sumNum/this.sumDenom},format:o,numInputs:null!=n&&null!=a?0:2}}}},sumOverSumBound80:function(o=!0,s=n){return function([n,a]){return function(t,e,r){return{sumNum:0,sumDenom:0,push:function(t){if(isNaN(parseFloat(t[n]))||(this.sumNum+=parseFloat(t[n])),!isNaN(parseFloat(t[a])))return this.sumDenom+=parseFloat(t[a])},value:function(){return(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*(o?1:-1)*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:s,numInputs:null!=n&&null!=a?0:2}}}},fractionOf:function(a,o="total",s=i){return function(...n){return function(t,e,r){return{selector:{total:[[],[]],row:[e,[]],col:[[],r]}[o],inner:a(...n)(t,e,r),push:function(t){return this.inner.push(t)},format:s,value:function(){return this.inner.value()/t.getAggregator(...this.selector).inner.value()},numInputs:a(...n)().numInputs}}}},countUnique:function(t){return u.uniques(function(t){return t.length},t)},listUnique:function(e){return u.uniques(function(t){return t.sort(rt).join(e)},function(t){return t})},max:function(t){return u.extremes("max",t)},min:function(t){return u.extremes("min",t)},first:function(t){return u.extremes("first",t)},last:function(t){return u.extremes("last",t)},median:function(t){return u.quantile(.5,t)},average:function(t){return u.runningStat("mean",1,t)},var:function(t,e){return u.runningStat("var",t,e)},stdev:function(t,e){return u.runningStat("stdev",t,e)}},a={Count:(a=u).count(s),"Count Unique Values":a.countUnique(s),"List Unique Values":a.listUnique(", "),Sum:a.sum(n),"Integer Sum":a.sum(s),Average:a.average(n),Median:a.median(n),"Sample Variance":a.var(1,n),"Sample Standard Deviation":a.stdev(1,n),Minimum:a.min(n),Maximum:a.max(n),First:a.first(n),Last:a.last(n),"Sum over Sum":a.sumOverSum(n),"80% Upper Bound":a.sumOverSumBound80(!0,n),"80% Lower Bound":a.sumOverSumBound80(!1,n),"Sum as Fraction of Total":a.fractionOf(a.sum(),"total",i),"Sum as Fraction of Rows":a.fractionOf(a.sum(),"row",i),"Sum as Fraction of Columns":a.fractionOf(a.sum(),"col",i),"Count as Fraction of Total":a.fractionOf(a.count(),"total",i),"Count as Fraction of Rows":a.fractionOf(a.count(),"row",i),"Count as Fraction of Columns":a.fractionOf(a.count(),"col",i)},c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=function(t){return("0"+t).substr(-2,2)},p=/(\d+)|(\D+)/g,f=/\d/,m=/^0/,rt=(t,e)=>{var r,n,a,o,s,l;if(null!=e&&null==t)return-1;if(null!=t&&null==e)return 1;if("number"==typeof t&&isNaN(t))return-1;if("number"==typeof e&&isNaN(e))return 1;if((s=+t)<(l=+e))return-1;if(l<s)return 1;if("number"==typeof t&&"number"!=typeof e)return-1;if("number"==typeof e&&"number"!=typeof t)return 1;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(l)&&!isNaN(s))return-1;if(isNaN(s)&&!isNaN(l))return 1;if((r=String(t))===(a=String(e)))return 0;if(!f.test(r)||!f.test(a))return a<r?1:-1;for(r=r.match(p),a=a.match(p);r.length&&a.length;)if((n=r.shift())!==(o=a.shift()))return f.test(n)&&f.test(o)?n.replace(m,".0")-o.replace(m,".0"):o<n?1:-1;return r.length-a.length},nt=function(t,e){var r;if(null!=t)if("function"==typeof t){if("function"==typeof(r=t(e)))return r}else if(null!=t[e])return t[e];return rt},at=class at{constructor(t,e={}){this.arrSort=this.arrSort.bind(this),this.sortKeys=this.sortKeys.bind(this),this.getColKeys=this.getColKeys.bind(this),this.getRowKeys=this.getRowKeys.bind(this),this.getAggregator=this.getAggregator.bind(this),this.input=t,this.aggregator=null!=(t=e.aggregator)?t:u.count()(),this.aggregatorName=null!=(t=e.aggregatorName)?t:"Count",this.colAttrs=null!=(t=e.cols)?t:[],this.rowAttrs=null!=(t=e.rows)?t:[],this.valAttrs=null!=(t=e.vals)?t:[],this.sorters=null!=(t=e.sorters)?t:{},this.rowOrder=null!=(t=e.rowOrder)?t:"key_a_to_z",this.colOrder=null!=(t=e.colOrder)?t:"key_a_to_z",this.derivedAttributes=null!=(t=e.derivedAttributes)?t:{},this.filter=null!=(t=e.filter)?t:function(){return!0},this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(this,[],[]),this.sorted=!1,at.forEachRecord(this.input,this.derivedAttributes,t=>{if(this.filter(t))return this.processRecord(t)})}static forEachRecord(t,n,a){var e,r,o,s,l,i,u,c,h,d,p,f=tt.isEmptyObject(n)?a:function(t){var e,r;for(e in n)r=n[e],t[e]=null!=(r=r(t))?r:t[e];return a(t)};if("function"==typeof t)return t(f);if(Array.isArray(t)){if(Array.isArray(t[0])){for(r in h=[],t)if(st.call(t,r)&&(e=t[r],0<r)){for(o in u={},c=t[0])st.call(c,o)&&(s=c[o],u[s]=e[o]);h.push(f(u))}return h}for(d=[],l=0,i=t.length;l<i;l++)u=t[l],d.push(f(u));return d}if(t instanceof tt)return p=[],tt("thead > tr > th",t).each(function(t){return p.push(tt(this).text())}),tt("tbody > tr",t).each(function(t){return u={},tt("td",this).each(function(t){return u[p[t]]=tt(this).text()}),f(u)});throw new Error("unknown input format")}forEachMatchingRecord(n,a){return at.forEachRecord(this.input,this.derivedAttributes,t=>{var e,r;if(this.filter(t)){for(e in n)if(n[e]!==(null!=(r=t[e])?r:"null"))return;return a(t)}})}arrSort(n){var a,o=function(){for(var t=[],e=0,r=n.length;e<r;e++)a=n[e],t.push(nt(this.sorters,a));return t}.call(this);return function(t,e){var r,n;for(n in o)if(st.call(o,n)&&0!==(r=(0,o[n])(t[n],e[n])))return r;return 0}}sortKeys(){var r;if(!this.sorted){switch(this.sorted=!0,r=(t,e)=>this.getAggregator(t,e).value(),this.rowOrder){case"value_a_to_z":this.rowKeys.sort((t,e)=>rt(r(t,[]),r(e,[])));break;case"value_z_to_a":this.rowKeys.sort((t,e)=>-rt(r(t,[]),r(e,[])));break;default:this.rowKeys.sort(this.arrSort(this.rowAttrs))}switch(this.colOrder){case"value_a_to_z":return this.colKeys.sort((t,e)=>rt(r([],t),r([],e)));case"value_z_to_a":return this.colKeys.sort((t,e)=>-rt(r([],t),r([],e)));default:return this.colKeys.sort(this.arrSort(this.colAttrs))}}}getColKeys(){return this.sortKeys(),this.colKeys}getRowKeys(){return this.sortKeys(),this.rowKeys}processRecord(t){for(var e,r,n,a,o,s,l,i,u=[],c=[],h=this.colAttrs,d=0,p=h.length;d<p;d++)i=h[d],u.push(null!=(o=t[i])?o:"null");for(a=0,n=(s=this.rowAttrs).length;a<n;a++)i=s[a],c.push(null!=(l=t[i])?l:"null");if(r=c.join(String.fromCharCode(0)),e=u.join(String.fromCharCode(0)),this.allTotal.push(t),0!==c.length&&(this.rowTotals[r]||(this.rowKeys.push(c),this.rowTotals[r]=this.aggregator(this,c,[])),this.rowTotals[r].push(t)),0!==u.length&&(this.colTotals[e]||(this.colKeys.push(u),this.colTotals[e]=this.aggregator(this,[],u)),this.colTotals[e].push(t)),0!==u.length&&0!==c.length)return this.tree[r]||(this.tree[r]={}),this.tree[r][e]||(this.tree[r][e]=this.aggregator(this,c,u)),this.tree[r][e].push(t)}getAggregator(t,e){var r=t.join(String.fromCharCode(0)),n=e.join(String.fromCharCode(0)),t=0===t.length&&0===e.length?this.allTotal:0===t.length?this.colTotals[n]:0===e.length?this.rowTotals[r]:this.tree[r][n];return null!=t?t:{value:function(){return null},format:function(){return""}}}};return tt.pivotUtilities={aggregatorTemplates:u,aggregators:a,renderers:t={Table:function(t,e){return l(t,e)},"Table Barchart":function(t,e){return tt(l(t,e)).barchart()},Heatmap:function(t,e){return tt(l(t,e)).heatmap("heatmap",e)},"Row Heatmap":function(t,e){return tt(l(t,e)).heatmap("rowheatmap",e)},"Col Heatmap":function(t,e){return tt(l(t,e)).heatmap("colheatmap",e)}},derivers:{bin:function(e,r){return function(t){return t[e]-t[e]%r}},dateFormat:function(e,n,t=!1,a=c,o=h){var s=t?"UTC":"";return function(t){var r=new Date(Date.parse(t[e]));return isNaN(r)?"":n.replace(/%(.)/g,function(t,e){switch(e){case"y":return r[`get${s}FullYear`]();case"m":return d(r[`get${s}Month`]()+1);case"n":return a[r[`get${s}Month`]()];case"d":return d(r[`get${s}Date`]());case"w":return o[r[`get${s}Day`]()];case"x":return r[`get${s}Day`]();case"H":return d(r[`get${s}Hours`]());case"M":return d(r[`get${s}Minutes`]());case"S":return d(r[`get${s}Seconds`]());default:return"%"+e}})}}},locales:et={en:{aggregators:a,renderers:t,localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter values",apply:"Apply",cancel:"Cancel",totals:"Totals",vs:"vs",by:"by"}}},naturalSort:rt,numberFormat:e,sortAs:function(t){var e,r,n={},a={};for(e in t)r=t[e],n[r]=e,"string"==typeof r&&(a[r.toLowerCase()]=e);return function(t,e){return null!=n[t]&&null!=n[e]?n[t]-n[e]:null!=n[t]?-1:null!=n[e]?1:null!=a[t]&&null!=a[e]?a[t]-a[e]:null!=a[t]?-1:null!=a[e]?1:rt(t,e)}},PivotData:at},l=function(s,l){var t,e,i,r,n,a,o,u,c,h,d,p,f,m,v,g,b,C,y,w,x,A,N;for(u in l=tt.extend(!0,{},{table:{clickCallback:null,rowTotals:!0,colTotals:!0},localeStrings:{totals:"Totals"}},l),i=s.colAttrs,d=s.rowAttrs,f=s.getRowKeys(),n=s.getColKeys(),l.table.clickCallback&&(a=function(e,t,r){var n,a,o={};for(a in i)st.call(i,a)&&(n=i[a],null!=r[a])&&(o[n]=r[a]);for(a in d)st.call(d,a)&&(n=d[a],null!=t[a])&&(o[n]=t[a]);return function(t){return l.table.clickCallback(t,e,o,s)}}),(h=document.createElement("table")).className="pvtTable",m=function(t,e,r){var n,a,o,s,l,i,u,c;if(0!==e){for(s=!0,c=n=0,l=r;0<=l?n<=l:l<=n;c=0<=l?++n:--n)t[e-1][c]!==t[e][c]&&(s=!1);if(s)return-1}for(a=0;e+a<t.length;){for(u=!1,c=o=0,i=r;0<=i?o<=i:i<=o;c=0<=i?++o:--o)t[e][c]!==t[e+a][c]&&(u=!0);if(u)break;a++}return a},C=document.createElement("thead"),i)if(st.call(i,u)){for(o in e=i[u],w=document.createElement("tr"),0===parseInt(u)&&0!==d.length&&((b=document.createElement("th")).setAttribute("colspan",d.length),b.setAttribute("rowspan",i.length),w.appendChild(b)),(b=document.createElement("th")).className="pvtAxisLabel",b.textContent=e,w.appendChild(b),n)st.call(n,o)&&(r=n[o],-1!==(N=m(n,parseInt(o),parseInt(u))))&&((b=document.createElement("th")).className="pvtColLabel",b.textContent=r[u],b.setAttribute("colspan",N),parseInt(u)===i.length-1&&0!==d.length&&b.setAttribute("rowspan",2),w.appendChild(b));0===parseInt(u)&&l.table.rowTotals&&((b=document.createElement("th")).className="pvtTotalLabel pvtRowTotalLabel",b.innerHTML=l.localeStrings.totals,b.setAttribute("rowspan",i.length+(0===d.length?0:1)),w.appendChild(b)),C.appendChild(w)}if(0!==d.length){for(o in w=document.createElement("tr"),d)st.call(d,o)&&(c=d[o],(b=document.createElement("th")).className="pvtAxisLabel",b.textContent=c,w.appendChild(b));b=document.createElement("th"),0===i.length&&(b.className="pvtTotalLabel pvtRowTotalLabel",b.innerHTML=l.localeStrings.totals),w.appendChild(b),C.appendChild(w)}for(o in h.appendChild(C),v=document.createElement("tbody"),f)if(st.call(f,o)){for(u in p=f[o],w=document.createElement("tr"),p)st.call(p,u)&&(x=p[u],-1!==(N=m(f,parseInt(o),parseInt(u))))&&((b=document.createElement("th")).className="pvtRowLabel",b.textContent=x,b.setAttribute("rowspan",N),parseInt(u)===d.length-1&&0!==i.length&&b.setAttribute("colspan",2),w.appendChild(b));for(u in n)st.call(n,u)&&(r=n[u],A=(t=s.getAggregator(p,r)).value(),(g=document.createElement("td")).className=`pvtVal row${o} col`+u,g.textContent=t.format(A),g.setAttribute("data-value",A),null!=a&&(g.onclick=a(A,p,r)),w.appendChild(g));!l.table.rowTotals&&0!==i.length||(A=(y=s.getAggregator(p,[])).value(),(g=document.createElement("td")).className="pvtTotal rowTotal",g.textContent=y.format(A),g.setAttribute("data-value",A),null!=a&&(g.onclick=a(A,p,[])),g.setAttribute("data-for","row"+o),w.appendChild(g)),v.appendChild(w)}if(l.table.colTotals||0===d.length){for(u in w=document.createElement("tr"),!l.table.colTotals&&0!==d.length||((b=document.createElement("th")).className="pvtTotalLabel pvtColTotalLabel",b.innerHTML=l.localeStrings.totals,b.setAttribute("colspan",d.length+(0===i.length?0:1)),w.appendChild(b)),n)st.call(n,u)&&(r=n[u],A=(y=s.getAggregator([],r)).value(),(g=document.createElement("td")).className="pvtTotal colTotal",g.textContent=y.format(A),g.setAttribute("data-value",A),null!=a&&(g.onclick=a(A,[],r)),g.setAttribute("data-for","col"+u),w.appendChild(g));!l.table.rowTotals&&0!==i.length||(A=(y=s.getAggregator([],[])).value(),(g=document.createElement("td")).className="pvtGrandTotal",g.textContent=y.format(A),g.setAttribute("data-value",A),null!=a&&(g.onclick=a(A,[],[])),w.appendChild(g)),v.appendChild(w)}return h.appendChild(v),h.setAttribute("data-numrows",f.length),h.setAttribute("data-numcols",n.length),h},tt.fn.pivot=async function(t,e,r="en"){var n,a,o,s;null==et[r]&&(r="en"),o={cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:at,filter:function(){return!0},aggregator:u.count()(),aggregatorName:"Count",sorters:{},derivedAttributes:{},renderer:l},r=tt.extend(!0,{},et.en.localeStrings,et[r].localeStrings),r=tt.extend(!0,{},{rendererOptions:{localeStrings:r},localeStrings:r},tt.extend({},o,e)),o=null;try{a=new r.dataClass(t,r);try{o=await r.renderer(a,r.rendererOptions)}catch(t){n=t,"undefined"!=typeof console&&null!==console&&console.error(n.stack),o=tt("<span>").html(r.localeStrings.renderError)}}catch(t){n=t,"undefined"!=typeof console&&null!==console&&console.error(n.stack),o=tt("<span>").html(r.localeStrings.computeError)}for(s=this[0];s.hasChildNodes();)s.removeChild(s.lastChild);return this.append(o)},tt.fn.pivotUI=function(M,U,K=!1,t="en"){var e,h,d,r,a,n,p,f,m,o,s,L,q,v,l,i,u,g,c,z,j,b,C,y,$,w,x,A,N,S,T,_,O,B,k,E,F,D,R,H={derivedAttributes:{},aggregators:et[t=null==et[t]?"en":t].aggregators,renderers:et[t].renderers,hiddenAttributes:[],hiddenFromAggregators:[],hiddenFromDragDrop:[],menuLimit:5e3,cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:at,exclusions:{},exclusionsTmp:{},inclusions:{},unusedAttrsVertical:85,autoSortUnusedAttrs:!1,onRefresh:null,showUI:!0,filter:function(){return!0},sorters:{}},t={rendererOptions:{localeStrings:t=tt.extend(!0,{},et.en.localeStrings,et[t].localeStrings)},localeStrings:t},P=this.data("pivotUIOptions"),V=null==P||K?tt.extend(!0,{},t,tt.extend({},H,U)):P,J=function(t,{attrName:e,attrValues:r,attrElem:n}){var a,o,s=(()=>{var t=[];for(a in r[e])t.push(a);return t})(),l=tt("<dialog>").attr("closedby","any").addClass("pvtAttrValuesBox").on("close",function(){return I()}),i=tt("<div>").addClass("toolbar"),u=tt("<button>",{type:"button"}).addClass("btn btn--confirm").text(t.localeStrings.apply).on("click",async function(){return t=Y(t,{attrName:e,attrElem:n}),await $(),I()}),c=tt("<div>").addClass("toolbar__shortcuts").append(tt("<button class='btn'>",{type:"button"}).html(t.localeStrings.selectAll).on("click",function(){return V=Z(t,{attrName:e,attrValues:s,isExcluded:!1})})).append(tt("<button class='btn'>",{type:"button"}).html(t.localeStrings.selectNone).on("click",function(){return V=Z(t,{attrName:e,attrValues:s,isExcluded:!0})})),h=tt("<input>",{type:"text",placeholder:t.localeStrings.filterResults,class:"pvtSearch",autofocus:!0,dir:"auto"}).attr("autofocus","true").attr("dir","auto").on("keyup",function(){var t=String(tt(this).val().toLowerCase()).trim();return l.find(".pvtCheckContainer li").each(function(){return-1!==tt(this).text().toLowerCase().indexOf(t)?tt(this).show():tt(this).hide()})}),d=tt("<h4>").text(`${e} - (${s.length})`);return s.length>t.menuLimit?l.append(tt("<p>").text(t.localeStrings.tooMany)):(o=G(s,r,t,e),l.append(i,d),i.append(u,c),l.append(tt("<br>")),l.append(h,o)),l},G=function(t,a,o,s){for(var l=tt("<ul>").addClass("pvtCheckContainer"),e=t.sort(nt(o.sorters,s)),r=0,n=e.length;r<n;r++)(e=>{var t=a[s][e],r=tt("<li>"),n=null!=(n=null!=o&&null!=(n=o.exclusions[s])?n.hasOwnProperty(e):void 0)&&n;tt("<input>").attr("type","checkbox").prop("checked",!n).data("filter",[s,e]).addClass("pvtFilter").appendTo(r).on("change",function(){var t=tt(this).is(":checked");return o=Q({attrName:s,value:e},t,o)}),r.append(tt("<span>").addClass("value").text(e)),r.append(tt("<span>").addClass("count").text("("+t+")")),l.append(r)})(e[r]);return l},I=function(){return tt(".pvtAttrValuesBox").remove()},W=function(t,{attrName:e,anchorSelector:r=".pvtUi",attrValues:n,attrElem:a}){var o;if(0<tt(".pvtAttrValuesBox").length&&I(),null==(o=tt(r)))throw`Element with selector ${r} was not found to attach the attrValuesBox to`;return(r=J(t,{attrName:e,attrValues:n,attrElem:a})).find(".pvtSearch").val(""),o.prepend(r),r[0].showModal()},Q=function({attrName:t,value:e},r,n){return n.exclusionsTmp[t]||(n.exclusionsTmp[t]={}),n.exclusionsTmp[t][e]=!r,n},Y=function(t,{attrName:e,attrElem:r}){return t.exclusions=X(t.exclusions,t.exclusionsTmp),t.exclusionsTmp={},Object.prototype.hasOwnProperty.call(V.exclusions,e)?r.addClass("pvtFilteredAttribute"):r.removeClass("pvtFilteredAttribute"),t},X=function(t,n){var a;if(t&&n)return a=t,Object.keys(n).forEach(r=>{var t=Object.keys(n[r]);if(a[r]||(a[r]={}),t.forEach(t=>{var e=n[r][t];if(e)return a[r][t]=e;delete a[r][t]}),!Object.keys(a[r]).length)return delete a[r]}),a;throw new TypeError("provide valid filter objects. filters must be of structure: {obj: {foo: boolean}}")},Z=function(t,{attrName:e,attrValues:r,isExcluded:n}){var a,o,s;for(t.exclusionsTmp[e]={},a=0,o=r.length;a<o;a++)s=r[a],t.exclusionsTmp[e][s]=n;return tt(".pvtFilter").prop("checked",!n),t};try{for(R in a={},v=[],c=0,at.forEachRecord(M,V.derivedAttributes,function(t){var e,r,n;if(V.filter(t)){for(e in v.push(t),t)st.call(t,e)&&null==a[e]&&(a[e]={},0<c)&&(a[e].null=c);for(e in a)n=null!=(n=t[e])?n:"null",null==(r=a[e])[n]&&(r[n]=0),a[e][n]++;return c++}}),k=tt("<table>",{class:"pvtUi"}).attr("cellpadding",5),A=tt("<td>").addClass("pvtUiCell"),x=tt("<select>").addClass("pvtRenderer").appendTo(A).on("change",function(){return y()}),z=V.renderers)st.call(z,R)&&tt("<option>").val(R).html(R).appendTo(x);if(E=tt("<td>").addClass("pvtAxisContainer pvtUnused pvtUiCell"),S=(()=>{var t=[];for(e in a)ot.call(V.hiddenAttributes,e)<0&&t.push(e);return t})(),T=(()=>{for(var t=[],e=0,r=S.length;e<r;e++)n=S[e],ot.call(V.hiddenFromAggregators,n)<0&&t.push(n);return t})(),_=(()=>{for(var t=[],e=0,r=S.length;e<r;e++)n=S[e],ot.call(V.hiddenFromDragDrop,n)<0&&t.push(n);return t})(),D=!1,F="auto"===V.unusedAttrsVertical?120:parseInt(V.unusedAttrsVertical),!isNaN(F)){for(o=r=0,s=_.length;o<s;o++)r+=(e=_[o]).length;D=F<r}for(f in!0===V.unusedAttrsVertical||D?E.addClass("pvtVertList"):E.addClass("pvtHorizList"),_)st.call(_,f)&&(t=>{var e=tt("<span>").addClass("pvtTriangle").html(" &#x25BE;").on("click",function(){return W(V,{attrName:t,attrValues:a,attrElem:r})}),r=tt("<li>").addClass("axis_"+f).append(tt("<span>").addClass("pvtAttr").text(t).data("attrName",t).append(e));E.append(r)})(d=_[f]);for(R in O=tt("<tr>").appendTo(k),h=tt("<select>").addClass("pvtAggregator").on("change",function(){return y()}),j=V.aggregators)st.call(j,R)&&h.append(tt("<option>").val(R).html(R));for(u={key_a_to_z:{rowSymbol:"&varr;",colSymbol:"&harr;",next:"value_a_to_z"},value_a_to_z:{rowSymbol:"&darr;",colSymbol:"&rarr;",next:"value_z_to_a"},value_z_to_a:{rowSymbol:"&uarr;",colSymbol:"&larr;",next:"key_a_to_z"}},N=tt("<a>",{role:"button"}).addClass("pvtRowOrder").data("order",V.rowOrder).html(u[V.rowOrder].rowSymbol).on("click",function(){return tt(this).data("order",u[tt(this).data("order")].next),tt(this).html(u[tt(this).data("order")].rowSymbol),y()}),p=tt("<a>",{role:"button"}).addClass("pvtColOrder").data("order",V.colOrder).html(u[V.colOrder].colSymbol).on("click",function(){return tt(this).data("order",u[tt(this).data("order")].next),tt(this).html(u[tt(this).data("order")].colSymbol),y()}),tt("<td>").addClass("pvtVals pvtUiCell").appendTo(O).append(h).append(N).append(p).append(tt("<br>")),tt("<td>").addClass("pvtAxisContainer pvtHorizList pvtCols pvtUiCell").appendTo(O),(B=tt("<tr>").appendTo(k)).append(tt("<td>").addClass("pvtAxisContainer pvtRows pvtUiCell").attr("valign","top")),g=tt("<td>").attr("valign","top").addClass("pvtRendererArea").appendTo(B),!0===V.unusedAttrsVertical||D?(k.find("tr:nth-child(1)").prepend(A),k.find("tr:nth-child(2)").prepend(E)):k.prepend(tt("<tr>").append(A).append(E)),this.html(k),b=V.cols,l=0,L=b.length;l<L;l++)R=b[l],this.find(".pvtCols").append(this.find(".axis_"+tt.inArray(R,_)));for(C=V.rows,i=0,q=C.length;i<q;i++)R=C[i],this.find(".pvtRows").append(this.find(".axis_"+tt.inArray(R,_)));null!=V.aggregatorName&&this.find(".pvtAggregator").val(V.aggregatorName),null!=V.rendererName&&this.find(".pvtRenderer").val(V.rendererName),V.showUI||this.find(".pvtUiCell").hide(),m=!0,w=()=>{var t,e,r,n,a,o,s,l,i={derivedAttributes:V.derivedAttributes,localeStrings:V.localeStrings,rendererOptions:V.rendererOptions,sorters:V.sorters,cols:[],rows:[],dataClass:V.dataClass},u=null!=(n=V.aggregators[h.val()]([])().numInputs)?n:0,c=[];if(this.find(".pvtRows li span.pvtAttr").each(function(){return i.rows.push(tt(this).data("attrName"))}),this.find(".pvtCols li span.pvtAttr").each(function(){return i.cols.push(tt(this).data("attrName"))}),this.find(".pvtVals select.pvtAttrDropdown").each(function(){return 0===u?tt(this).remove():(u--,""!==tt(this).val()?c.push(tt(this).val()):void 0)}),0!==u)for(r=this.find(".pvtVals"),R=o=0,a=u;0<=a?o<a:a<o;R=0<=a?++o:--o){for(e=tt("<select>").addClass("pvtAttrDropdown").append(tt("<option>")).on("change",function(){return y()}),s=0,t=T.length;s<t;s++)d=T[s],e.append(tt("<option>").val(d).text(d));r.append(e)}if(m&&(c=V.vals,f=0,this.find(".pvtVals select.pvtAttrDropdown").each(function(){return tt(this).val(c[f]),f++}),m=!1),i.aggregatorName=h.val(),i.vals=c,i.aggregator=V.aggregators[h.val()](c),i.renderer=V.renderers[x.val()],i.rowOrder=N.data("order"),i.colOrder=p.data("order"),i.filter=function(t){var e,r,n;if(!V.filter(t))return!1;for(r in n=V.exclusions)for(d in e=n[r])if(t[r]===d&&e[d])return!1;return!0},g.pivot(v,i),n=tt.extend({},V,{cols:i.cols,rows:i.rows,colOrder:i.colOrder,rowOrder:i.rowOrder,vals:c,inclusionsInfo:V.inclusions,aggregatorName:h.val(),rendererName:x.val()}),this.data("pivotUIOptions",n),V.autoSortUnusedAttrs&&(l=this.find("td.pvtUnused.pvtAxisContainer"),tt(l).children("li").sort((t,e)=>rt(tt(t).text(),tt(e).text())).appendTo(l)),g.css("opacity",1),null!=V.onRefresh)return V.onRefresh(n)},$=()=>(g.css("opacity",.5),new Promise(function(t){return setTimeout(function(){return w(),t()},10)})),(y=()=>(g.css("opacity",.5),setTimeout(w,10)))(),this.find(".pvtAxisContainer").sortable({update:function(t,e){if(null==e.sender)return y()},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"})}catch(t){"undefined"!=typeof console&&null!==console&&console.error(t.stack),this.html(V.localeStrings.uiRenderError)}return this},tt.fn.heatmap=function(t="heatmap",e){var r,n,a,o,s,l,i,u=this.data("numrows"),c=this.data("numcols"),h=null!=e&&null!=(e=e.heatmap)?e.colorScaleGenerator:void 0;switch(null==h&&(h=function(t){var e=Math.min(...t),r=Math.max(...t);return function(t){t=255-Math.round(255*(t-e)/(r-e));return`rgb(255,${t},${t})`}}),r=t=>{var r,e=e=>this.find(t).each(function(){var t=tt(this).data("value");if(null!=t&&isFinite(t))return e(t,tt(this))}),n=[];return e(function(t){return n.push(t)}),r=h(n),e(function(t,e){return e.css("background-color",r(t))})},t){case"heatmap":r(".pvtVal");break;case"rowheatmap":for(n=o=0,l=u;0<=l?o<l:l<o;n=0<=l?++o:--o)r(".pvtVal.row"+n);break;case"colheatmap":for(a=s=0,i=c;0<=i?s<i:i<s;a=0<=i?++s:--s)r(".pvtVal.col"+a)}return r(".pvtTotal.rowTotal"),r(".pvtTotal.colTotal"),this},tt.fn.barchart=function(t){for(var e,r=this.data("numrows"),n=(this.data("numcols"),t=>{var e,s,r,l,n=e=>this.find(t).each(function(){var t=tt(this).data("value");if(null!=t&&isFinite(t))return e(t,tt(this))}),a=[];return n(function(t){return a.push(t)}),e=Math.max(...a),r=e=e<0?0:e,(s=Math.min(...a))<0&&(r=e-s),l=function(t){return 100*t/(1.4*r)},n(function(t,e){var r=e.text(),n=tt("<div>").css({position:"relative",height:"55px"}),a="gray",o=s<0?l(-s):0;return t<0&&(o+=l(t),a="darkred",t=-t),n.append(tt("<div>").css({position:"absolute",bottom:o+"%",left:0,right:0,height:l(t)+"%","background-color":a})),n.append(tt("<div>").text(r).css({position:"relative","padding-left":"5px","padding-right":"5px"})),e.css({padding:0,"padding-top":"5px","text-align":"center"}).html(n)})}),a=e=0,o=r;0<=o?e<o:o<e;a=0<=o?++e:--e)n(".pvtVal.row"+a);return n(".pvtTotal.colTotal"),this}};"object"==typeof exports&&"object"==typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}.call(this);
//# sourceMappingURL=pivot.min.js.map
