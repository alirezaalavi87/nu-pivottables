{"version":3,"sources":["d3_renderers.coffee"],"names":["pivotModule","$","d3","pivotUtilities","d3_renderers","Treemap","pivotData","opts","addToTree","color","i","len","ref","result","rowKey","tree","treemap","value","width","extend","localeStrings","window","height","css","name","children","path","child","newChild","x","length","shift","push","getRowKeys","getAggregator","scale","category10","layout","size","sticky","d","select","append","style","datum","selectAll","data","padding","nodes","enter","attr","text","call","this","y","Math","max","dx","dy","exports","module","require","define","amd","jQuery"],"mappings":"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","file":"d3_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\"), require(\"d3\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\", \"d3\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery, d3\n\ncallWithJQuery ($, d3) ->\n\n    $.pivotUtilities.d3_renderers = Treemap: (pivotData, opts) ->\n        defaults =\n            localeStrings: {}\n            d3:\n                width: -> $(window).width() / 1.4\n                height: -> $(window).height() / 1.4\n\n        opts = $.extend(true, {}, defaults, opts)\n\n\n        result = $(\"<div>\").css(width: \"100%\", height: \"100%\")\n\n        tree = name: \"All\", children: []\n        addToTree = (tree, path, value) ->\n            if path.length == 0\n                tree.value = value\n                return\n            tree.children ?= []\n            x = path.shift()\n            for child in tree.children when child.name == x\n                addToTree(child, path, value)\n                return\n            newChild = name: x\n            addToTree(newChild, path, value)\n            tree.children.push newChild\n\n        for rowKey in pivotData.getRowKeys()\n            value = pivotData.getAggregator(rowKey, []).value()\n            if value?\n                addToTree(tree, rowKey, value)\n\n        color = d3.scale.category10()\n        width = opts.d3.width()\n        height = opts.d3.height()\n\n        treemap = d3.layout.treemap()\n            .size([width, height])\n            .sticky(true)\n            .value( (d) -> d.size )\n\n        d3.select(result[0])\n            .append(\"div\")\n                .style(\"position\", \"relative\")\n                .style(\"width\", width + \"px\")\n                .style(\"height\", height + \"px\")\n            .datum(tree).selectAll(\".node\")\n                .data(treemap.padding([15,0,0,0]).value( (d) -> d.value ).nodes)\n            .enter().append(\"div\")\n            .attr(\"class\", \"node\")\n            .style(\"background\", (d) -> if d.children? then \"lightgrey\" else color(d.name) )\n            .text( (d) -> d.name )\n            .call ->\n                    this.style(\"left\",  (d) -> d.x+\"px\" )\n                        .style(\"top\",   (d) -> d.y+\"px\" )\n                        .style(\"width\", (d) -> Math.max(0, d.dx - 1)+\"px\" )\n                        .style(\"height\",(d) -> Math.max(0, d.dy - 1)+\"px\" )\n                    return\n\n        return result\n\n\n\n"]}