{"version":3,"sources":["bb_renderers.coffee"],"names":["pivotModule","$","bb","makeBBChart","chartOpts","pivotData","opts","agg","c","colKey","colKeys","columns","dataColumns","formatter","fullAggName","h","headers","i","j","k","l","len","len1","len2","len3","len4","m","numCharsInHAxis","numSeries","ref1","ref3","rotationAngle","row","rowHeader","rowKey","rowKeys","s","scatterData","series","title","titleText","vAxisTitle","val","vals","x","xs","y","extend","localeStrings","vs","by","size","width","window","innerWidth","height","innerHeight","type","horizontal","stacked","getRowKeys","length","push","getColKeys","results","join","aggregatorName","valAttrs","t","ref","attrs","rowAttrs","concat","colAttrs","hAxisTitle","groupByTitle","slice","getAggregator","value","ref2","parseFloat","isFinite","style","attr","text","format","params","axis","rotated","label","tick","rotate","multiline","data","order","tooltip","grouped","color","pattern","clipPath","resize","auto","timer","fit","legend","show","name","a","b","d","e","v","categories","n","len5","shift","unshift","rows","groups","result","appendTo","bindto","generate","detach","append","pivotUtilities","bb_renderers","Horizontal Bar Chart","Horizontal Stacked Bar Chart","Bar Chart","Stacked Bar Chart","Line Chart","Area Chart","Scatter Chart","exports","module","require","define","amd","jQuery"],"mappings":"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","file":"bb_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\"), require(\"bb\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\", \"bb\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery, bb\n\ncallWithJQuery ($, bb) ->\n\n    makeBBChart = (chartOpts = {}) -> (pivotData, opts) ->\n        defaults =\n            localeStrings: {vs: \"vs\", by: \"by\"}\n            bb: {}\n\n        opts = $.extend(true, {}, defaults, opts)\n        opts.bb.size ?= {}\n        opts.bb.size.width ?= window.innerWidth\n        opts.bb.size.height ?= window.innerHeight\n        chartOpts.type ?= \"line\"\n        chartOpts.horizontal ?= false\n        chartOpts.stacked ?= false\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n\n        headers = (h.join(\"-\") for h in colKeys)\n        rotationAngle = 0\n\n        fullAggName = pivotData.aggregatorName\n        if pivotData.valAttrs.length\n            fullAggName += \"(#{pivotData.valAttrs.join(\", \")})\"\n\n        if chartOpts.type == \"scatter\"\n            scatterData = x:{}, y:{}, t:{}\n            attrs = pivotData.rowAttrs.concat(pivotData.colAttrs)\n            vAxisTitle = attrs[0] ? \"\"\n            hAxisTitle = attrs[1] ? \"\"\n            groupByTitle = attrs.slice(2).join(\"-\")\n            titleText = vAxisTitle\n            titleText += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            titleText += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n            for rowKey in rowKeys\n                for colKey in colKeys\n                    agg = pivotData.getAggregator(rowKey, colKey)\n                    if agg.value()?\n                        vals = rowKey.concat(colKey)\n                        series = vals.slice(2).join(\"-\")\n                        if series == \"\" then series = \"series\"\n                        scatterData.x[series] ?= []\n                        scatterData.y[series] ?= []\n                        y = vals[0] ? 0\n                        x = vals[1] ? 0\n                        scatterData.y[series].push y\n                        scatterData.x[series].push x\n                        scatterData.t[series] ?= {}\n                        scatterData.t[series][x] ?= {}\n                        scatterData.t[series][x][y] = agg.value()\n        else\n            numCharsInHAxis = 0\n            for x in headers\n                numCharsInHAxis += x.length\n            if numCharsInHAxis > 50\n                rotationAngle = 45\n\n            columns = []\n            for rowKey in rowKeys\n                rowHeader = rowKey.join(\"-\")\n                row = [if rowHeader == \"\" then fullAggName else rowHeader]\n                for colKey in colKeys\n                    val = parseFloat  pivotData.getAggregator(rowKey, colKey).value()\n                    if isFinite(val)\n                        row.push(val)\n                    else\n                        row.push(null)\n                columns.push row\n\n            vAxisTitle = fullAggName\n\n            if chartOpts.horizontal\n                hAxisTitle = pivotData.rowAttrs.join(\"-\")\n                groupByTitle = pivotData.colAttrs.join(\"-\")\n            else\n                hAxisTitle = pivotData.colAttrs.join(\"-\")\n                groupByTitle = pivotData.rowAttrs.join(\"-\")\n            titleText = fullAggName\n            titleText += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            titleText += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n\n        title = $(\"<p>\", {style: \"text-align: center; font-weight: bold\"})\n        title.attr(\"dir\", \"auto\")\n        title.text(titleText)\n\n        formatter = pivotData.getAggregator([], []).format\n\n        params =\n            axis:\n                rotated: chartOpts.horizontal\n                y:\n                    label: vAxisTitle\n                    tick: {}\n                x:\n                    label: hAxisTitle\n                    tick:\n                        rotate: rotationAngle\n                        multiline: false\n            data:\n                type: chartOpts.type\n                order: null\n            tooltip:\n                grouped: false\n            color:\n                pattern: [ \"#3366cc\", \"#dc3912\", \"#ff9900\", \"#109618\",\n                           \"#990099\", \"#0099c6\", \"#dd4477\", \"#66aa00\",\n                           \"#b82e2e\", \"#316395\", \"#994499\", \"#22aa99\",\n                           \"#aaaa11\", \"#6633cc\", \"#e67300\", \"#8b0707\",\n                           \"#651067\", \"#329262\", \"#5574a6\", \"#3b3eac\" ]\n            clipPath: false\n            resize:\n                auto: \"parent\"\n                timer: false\n\n\n        params = $.extend(true, {}, params, opts.bb)\n        if chartOpts.type == \"scatter\"\n            xs = {}\n            numSeries = 0\n            dataColumns = []\n            for s of scatterData.x\n                numSeries += 1\n                xs[s] = s+\"_x\"\n                dataColumns.push [s+\"_x\"].concat(scatterData.x[s])\n                dataColumns.push [s].concat(scatterData.y[s])\n            params.data.xs = xs\n            params.data.columns = dataColumns\n            params.axis.x.tick = fit: false\n            if numSeries == 1\n                params.legend = show: false\n            params.tooltip.format =\n                title: -> fullAggName\n                name: -> \"\"\n                value: (a,b,c,d,e) ->\n                    {name: series, value: y, x} = e[0]\n                    formatter(scatterData.t[series][x][y])\n        else\n            params.axis.x.type= 'category'\n            params.axis.y.tick.format ?= (v) -> formatter(v)\n            params.tooltip.format = value: (v) -> formatter(v)\n\n            if chartOpts.horizontal\n                categories = (c.shift() for c in columns)\n                if categories.length == 1 and categories[0] == fullAggName\n                    categories = [\"\"]\n                params.axis.x.categories = categories\n                if headers.length == 1 and headers[0] == \"\"\n                    headers = [fullAggName]\n                columns.unshift(headers)\n                params.data.rows = columns\n            else\n                params.axis.x.categories = headers\n                params.data.columns = columns\n\n\n        if chartOpts.stacked\n            if chartOpts.horizontal\n                params.data.groups = [x.join(\"-\") for x in colKeys]\n            else\n                params.data.groups = [x.join(\"-\") for x in rowKeys]\n\n        # attaching to the render box results in correct rendering and calculation of dimensions.\n        # Lazy rendering might also be possible but I couldn't figure it out.\n        # https://github.com/naver/billboard.js/issues/1015\n        result = $(\"<div>\").appendTo $(\".pvtRendererArea\")\n        params.bindto = result[0]\n        bb.generate params\n        result.detach()\n        return $(\"<div>\").append title, result\n\n    $.pivotUtilities.bb_renderers =\n        \"Horizontal Bar Chart\": makeBBChart(type: \"bar\", horizontal: true)\n        \"Horizontal Stacked Bar Chart\": makeBBChart(type: \"bar\", stacked: true, horizontal: true)\n        \"Bar Chart\": makeBBChart(type: \"bar\")\n        \"Stacked Bar Chart\": makeBBChart(type: \"bar\", stacked: true)\n        \"Line Chart\": makeBBChart()\n        \"Area Chart\": makeBBChart(type: \"area\", stacked: true)\n        \"Scatter Chart\": makeBBChart(type: \"scatter\")\n"]}