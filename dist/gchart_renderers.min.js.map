{"version":3,"sources":["gchart_renderers.coffee"],"names":["pivotModule","$","makeGoogleChart","chartType","extraOptions","pivotData","opts","agg","colKey","colKeys","dataArray","dataTable","fullAggName","h","hAxisTitle","i","j","len","len1","numCharsInHAxis","options","ref","result","row","rowKeys","title","tree2","vAxisTitle","val","wrapper","x","y","extend","localeStrings","vs","by","gchart","width","window","innerWidth","height","innerHeight","getRowKeys","length","push","getColKeys","aggregatorName","valAttrs","join","headers","results","unshift","tree","parseFloat","format","value","google","visualization","DataTable","addColumn","colAttrs","rowAttrs","type","role","addRows","getAggregator","rowKey","isNumeric","toPrecision","toFixed","arrayToDataTable","groupByTitle","hAxis","slantedText","vAxis","tooltip","textStyle","fontName","fontSize","minValue","legend","position","chartArea","css","ChartWrapper","draw","on","editor","ChartEditor","events","addListener","getChartWrapper","openDialog","pivotUtilities","gchart_renderers","Line Chart","Bar Chart","Stacked Bar Chart","isStacked","Area Chart","Scatter Chart","exports","module","require","define","amd","jQuery"],"mappings":"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","file":"gchart_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery\n\ncallWithJQuery ($) ->\n\n    makeGoogleChart = (chartType, extraOptions) -> (pivotData, opts) ->\n        defaults =\n            localeStrings:\n                vs: \"vs\"\n                by: \"by\"\n            gchart: {}\n\n        opts = $.extend(true, {}, defaults, opts)\n        opts.gchart.width ?= window.innerWidth / 1.4\n        opts.gchart.height ?= window.innerHeight / 1.4\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n        fullAggName = pivotData.aggregatorName\n        if pivotData.valAttrs.length\n            fullAggName += \"(#{pivotData.valAttrs.join(\", \")})\"\n        headers = (h.join(\"-\") for h in rowKeys)\n        headers.unshift \"\"\n\n        numCharsInHAxis = 0\n        if chartType == \"ScatterChart\"\n            dataArray = []\n            for y, tree2 of pivotData.tree\n                for x, agg of tree2\n                     dataArray.push [\n                        parseFloat(x),\n                        parseFloat(y),\n                        fullAggName+\": \\n\"+agg.format(agg.value())\n                        ]\n            dataTable = new google.visualization.DataTable()\n            dataTable.addColumn 'number', pivotData.colAttrs.join(\"-\")\n            dataTable.addColumn 'number', pivotData.rowAttrs.join(\"-\")\n            dataTable.addColumn type: \"string\", role: \"tooltip\"\n            dataTable.addRows dataArray\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\n            vAxisTitle = pivotData.rowAttrs.join(\"-\")\n            title = \"\"\n        else\n            dataArray = [headers]\n            for colKey in colKeys\n                row = [colKey.join(\"-\")]\n                numCharsInHAxis += row[0].length\n                for rowKey in rowKeys\n                    agg = pivotData.getAggregator(rowKey, colKey)\n                    if agg.value()?\n                        val = agg.value()\n                        if $.isNumeric val\n                            if val < 1\n                                row.push parseFloat(val.toPrecision(3))\n                            else\n                                row.push parseFloat(val.toFixed(3))\n                        else\n                            row.push val\n                    else row.push null\n                dataArray.push row\n\n            dataTable = google.visualization.arrayToDataTable(dataArray)\n\n            title = vAxisTitle = fullAggName\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\n            title += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            groupByTitle = pivotData.rowAttrs.join(\"-\")\n            title += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n\n        options =\n            title: title\n            hAxis: {title: hAxisTitle, slantedText: numCharsInHAxis > 50}\n            vAxis: {title: vAxisTitle}\n            tooltip: { textStyle: { fontName: 'Arial', fontSize: 12 } }\n\n        if chartType == \"ColumnChart\"\n            options.vAxis.minValue = 0\n\n        if chartType == \"ScatterChart\"\n            options.legend = position: \"none\"\n            options.chartArea = {'width': '80%', 'height': '80%'}\n\n        else if dataArray[0].length == 2 and dataArray[0][1] ==  \"\"\n            options.legend = position: \"none\"\n\n        options = $.extend(true, {}, options, opts.gchart, extraOptions)\n\n        result = $(\"<div>\").css(width: \"100%\", height: \"100%\")\n        wrapper = new google.visualization.ChartWrapper {dataTable, chartType, options}\n        wrapper.draw(result[0])\n        result.on \"dblclick\", ->\n            editor = new google.visualization.ChartEditor()\n            google.visualization.events.addListener editor, 'ok', ->\n                editor.getChartWrapper().draw(result[0])\n            editor.openDialog(wrapper)\n        return result\n\n    $.pivotUtilities.gchart_renderers =\n        \"Line Chart\": makeGoogleChart(\"LineChart\")\n        \"Bar Chart\": makeGoogleChart(\"ColumnChart\")\n        \"Stacked Bar Chart\": makeGoogleChart(\"ColumnChart\", isStacked: true)\n        \"Area Chart\": makeGoogleChart(\"AreaChart\", isStacked: true)\n        \"Scatter Chart\": makeGoogleChart(\"ScatterChart\")\n"]}