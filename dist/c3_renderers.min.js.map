{"version":3,"sources":["c3_renderers.coffee"],"names":["pivotModule","$","c3","makeC3Chart","chartOpts","pivotData","opts","agg","c","colKey","colKeys","columns","dataColumns","formatter","fullAggName","h","headers","j","k","l","len","len1","len2","len3","len4","m","n","numCharsInHAxis","numSeries","ref1","ref3","rotationAngle","row","rowHeader","rowKey","rowKeys","s","scatterData","series","title","titleText","vAxisTitle","val","vals","x","xs","y","extend","localeStrings","vs","by","size","width","window","innerWidth","height","innerHeight","type","horizontal","stacked","getRowKeys","length","push","getColKeys","results","join","aggregatorName","valAttrs","t","ref","attrs","rowAttrs","concat","colAttrs","hAxisTitle","groupByTitle","slice","getAggregator","value","ref2","parseFloat","isFinite","style","attr","text","format","params","axis","rotated","label","tick","rotate","multiline","data","order","tooltip","grouped","color","pattern","fit","legend","show","name","ratio","id","i","categories","v","o","len5","shift","unshift","rows","groups","renderArea","appendTo","result","bindto","generate","error1","console","error","detach","remove","append","pivotUtilities","c3_renderers","Horizontal Bar Chart","Horizontal Stacked Bar Chart","Bar Chart","Stacked Bar Chart","Line Chart","Area Chart","Scatter Chart","exports","module","require","define","amd","jQuery"],"mappings":"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","file":"c3_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\"), require(\"c3\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\", \"c3\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery, c3\n\ncallWithJQuery ($, c3) ->\n\n    makeC3Chart = (chartOpts = {}) -> (pivotData, opts) ->\n        defaults =\n            localeStrings: {vs: \"vs\", by: \"by\"}\n            c3: {}\n\n        opts = $.extend(true, {}, defaults, opts)\n        opts.c3.size ?= {}\n        opts.c3.size.width ?= window.innerWidth\n        opts.c3.size.height ?= window.innerHeight\n        chartOpts.type ?= \"line\"\n        chartOpts.horizontal ?= false\n        chartOpts.stacked ?= false\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n\n        headers = (h.join(\"-\") for h in colKeys)\n        rotationAngle = 0\n\n        fullAggName = pivotData.aggregatorName\n        if pivotData.valAttrs.length\n            fullAggName += \"(#{pivotData.valAttrs.join(\", \")})\"\n\n        if chartOpts.type == \"scatter\"\n            scatterData = x:{}, y:{}, t:{}\n            attrs = pivotData.rowAttrs.concat(pivotData.colAttrs)\n            vAxisTitle = attrs[0] ? \"\"\n            hAxisTitle = attrs[1] ? \"\"\n            groupByTitle = attrs.slice(2).join(\"-\")\n            titleText = vAxisTitle\n            titleText += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            titleText += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n            for rowKey in rowKeys\n                for colKey in colKeys\n                    agg = pivotData.getAggregator(rowKey, colKey)\n                    if agg.value()?\n                        vals = rowKey.concat(colKey)\n                        series = vals.slice(2).join(\"-\")\n                        if series == \"\" then series = \"series\"\n                        scatterData.x[series] ?= []\n                        scatterData.y[series] ?= []\n                        y = vals[0] ? 0\n                        x = vals[1] ? 0\n                        scatterData.y[series].push y\n                        scatterData.x[series].push x\n                        scatterData.t[series] ?= {}\n                        scatterData.t[series][x] ?= {}\n                        scatterData.t[series][x][y] = agg.value()\n        else\n            numCharsInHAxis = 0\n            for x in headers\n                numCharsInHAxis += x.length\n            if numCharsInHAxis > 50\n                rotationAngle = 45\n\n            columns = []\n            for rowKey in rowKeys\n                rowHeader = rowKey.join(\"-\")\n                row = [if rowHeader == \"\" then fullAggName else rowHeader]\n                for colKey in colKeys\n                    val = parseFloat  pivotData.getAggregator(rowKey, colKey).value()\n                    if isFinite(val)\n                        row.push(val)\n                    else\n                        row.push(null)\n                columns.push row\n\n            vAxisTitle = fullAggName\n\n            if chartOpts.horizontal\n                hAxisTitle = pivotData.rowAttrs.join(\"-\")\n                groupByTitle = pivotData.colAttrs.join(\"-\")\n            else\n                hAxisTitle = pivotData.colAttrs.join(\"-\")\n                groupByTitle = pivotData.rowAttrs.join(\"-\")\n            titleText = fullAggName\n            titleText += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            titleText += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n\n        title = $(\"<p>\", {style: \"text-align: center; font-weight: bold\"})\n        title.attr(\"dir\", \"auto\")\n        title.text(titleText)\n\n        formatter = pivotData.getAggregator([], []).format\n\n        params =\n            axis:\n                rotated: chartOpts.horizontal\n                y:\n                    label:\n                      text: vAxisTitle\n                    tick: {}\n                x:\n                    label:\n                      text: hAxisTitle\n                    tick:\n                        rotate: rotationAngle\n                        multiline: false\n            data:\n                type: chartOpts.type\n                order: null\n            tooltip:\n                grouped: false\n            color:\n                pattern: [ \"#3366cc\", \"#dc3912\", \"#ff9900\", \"#109618\",\n                           \"#990099\", \"#0099c6\", \"#dd4477\", \"#66aa00\",\n                           \"#b82e2e\", \"#316395\", \"#994499\", \"#22aa99\",\n                           \"#aaaa11\", \"#6633cc\", \"#e67300\", \"#8b0707\",\n                           \"#651067\", \"#329262\", \"#5574a6\", \"#3b3eac\" ]\n\n\n        params = $.extend(true, {}, params, opts.c3)\n        if chartOpts.type == \"scatter\"\n            xs = {}\n            numSeries = 0\n            dataColumns = []\n            for s of scatterData.x\n                numSeries += 1\n                xs[s] = s+\"_x\"\n                dataColumns.push [s+\"_x\"].concat(scatterData.x[s])\n                dataColumns.push [s].concat(scatterData.y[s])\n            params.data.xs = xs\n            params.data.columns = dataColumns\n            params.axis.x.tick = fit: false\n            if numSeries == 1\n                params.legend = show: false\n            params.tooltip.format =\n                title: -> fullAggName\n                name: (name, ratio, id, i) -> \"\"\n                value: (value, ratio, id, i) ->\n                    {name: series, value: y, x} = i[0]\n                    formatter(scatterData.t[series][x][y])\n        else\n            params.axis.x =\n                type: \"category\"\n                categories: headers\n\n            params.axis.y.tick.format ?= (v) -> formatter(v)\n            params.tooltip.format = value: (v) -> formatter(v)\n\n            if chartOpts.horizontal\n                categories = (c.shift() for c in columns)\n                if categories.length == 1 and categories[0] == fullAggName\n                    categories = [\"\"]\n                params.axis.x.categories = categories\n\n                if headers.length == 1 and headers[0] == \"\"\n                    headers = [fullAggName]\n\n                columns.unshift(headers)\n                params.data.rows = columns\n            else\n                params.axis.x.categories = headers\n                params.data.columns = columns\n\n\n        if chartOpts.stacked\n            if chartOpts.horizontal\n                params.data.groups = [x.join(\"-\") for x in colKeys]\n            else\n                params.data.groups = [x.join(\"-\") for x in rowKeys]\n\n        renderArea = $(\"<div>\", style: \"display:none;\").appendTo $(\"body\")\n        result = $(\"<div>\").appendTo renderArea\n        params.bindto = result[0]\n        try\n          chart = c3.generate params\n        catch error\n          console.error \"Error in generating C3 chart:\", error\n        result.detach()\n        renderArea.remove()\n        return $(\"<div>\").append title, result\n\n    $.pivotUtilities.c3_renderers =\n        \"Horizontal Bar Chart\": makeC3Chart(type: \"bar\", horizontal: true)\n        \"Horizontal Stacked Bar Chart\": makeC3Chart(type: \"bar\", stacked: true, horizontal: true)\n        \"Bar Chart\": makeC3Chart(type: \"bar\")\n        \"Stacked Bar Chart\": makeC3Chart(type: \"bar\", stacked: true)\n        \"Line Chart\": makeC3Chart()\n        \"Area Chart\": makeC3Chart(type: \"area\", stacked: true)\n        \"Scatter Chart\": makeC3Chart(type: \"scatter\")\n"]}