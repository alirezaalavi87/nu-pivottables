function uid(e){var t=Math.random().toString(36).substr(2,9);return e?e+"-"+t:t}function callWithJQuery(e){"object"==typeof exports&&"object"==typeof module?e(require("jquery"),require("d3")):"function"==typeof define&&define.amd?define(["jquery","d3"],e):e(jQuery,d3)}let initializeDefaults=e=>({localeStrings:{},d3:{width:()=>e(window).width(),height:()=>e(window).height()}}),defaultTree={name:"All",children:[]},pivotDataToTreemapInput=t=>t.getRowKeys().map(e=>({path:e.map(String),value:t.getAggregator(e,[]).value()})),addSubtreeToTree=(e,t,r)=>{if(0===t.length)return{...e,value:r};let[a,...i]=t,d=e.children.findIndex(e=>e.name===a);t=-1!==d?e.children.map((e,t)=>t===d?addSubtreeToTree(e,i,r):e):[...e.children,addSubtreeToTree({name:a,children:[]},i,r)];return{...e,children:t}},createTreeMap=(e={name:"All",children:[]},t)=>t.reduce((e,t)=>addSubtreeToTree(e,t.path,t.value),e),renderTreeMap=(e,t,r)=>{let a=d3.scaleSequential([8,0],d3.interpolateMagma);e=e;e=d3.treemap().size([t,r]).paddingOuter(3).paddingTop(19).paddingInner(1).round(!0)(d3.hierarchy(e).sum(e=>e.value).sort((e,t)=>t.value-e.value)),t=d3.create("svg").attr("width",t).attr("height",r).attr("viewBox",[0,0,t,r]).attr("style","max-width: 100%; height: auto; overflow: visible; font: 10px sans-serif;"),r=t.selectAll("g").data(d3.group(e,e=>e.height)).join("g").selectAll("g").data(e=>e[1]).join("g").attr("transform",e=>`translate(${e.x0},${e.y0})`);let i=d3.format(",d");return r.append("title").text(e=>e.ancestors().reverse().map(e=>e.data.name).join("/")+`
`+i(e.value)),r.append("rect").attr("id",e=>e.nodeUid=uid("node")).attr("fill",e=>a(e.height)).attr("width",e=>e.x1-e.x0).attr("height",e=>e.y1-e.y0),r.append("clipPath").attr("id",e=>e.clipUid=uid("clip")).append("use").attr("xlink:href",e=>"#"+e.nodeUid),r.append("text").attr("clip-path",e=>`url(#${e.clipUid})`).selectAll("tspan").data(e=>e.data.name.split(/(?=[A-Z][^A-Z])/g).concat(i(e.value))).join("tspan").attr("fill-opacity",(e,t,r)=>t===r.length-1?.7:null).text(e=>e),r.filter(e=>e.children).selectAll("tspan").attr("dx",3).attr("y",13),r.filter(e=>!e.children).selectAll("tspan").attr("x",3).attr("y",(e,t,r)=>.3*(t===r.length-1)+1.1+.9*t+"em"),t.node()},renderTreeMapUI=e=>{var t=$("<div>").css({width:"100%",height:"100%"});return t.append(e),t},createD3Renderers=(a,e)=>({TreeMap:(e,t)=>{var r=initializeDefaults(a),r=(t=a.extend(!0,{},r,t),pivotDataToTreemapInput(e)),e=(console.log(r),createTreeMap(defaultTree,r)),r=renderTreeMap(e,t.d3.width(),t.d3.height());return renderTreeMapUI(r)}});callWithJQuery((e,t)=>{e.pivotUtilities.d3_renderers=createD3Renderers(e,t)});