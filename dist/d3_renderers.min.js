let uniqueId=(e=16)=>crypto.randomUUID?crypto.randomUUID():parseInt(Math.ceil(Math.random()*Date.now()).toPrecision(e).toString().replace(".","")),mergeOptions=(e,t)=>Object.assign({},e,t);function callWithJQuery(e){"object"==typeof exports&&"object"==typeof module?e(require("jquery"),require("d3")):"function"==typeof define&&define.amd?define(["jquery","d3"],e):e(jQuery,d3)}let initializeDefaults=e=>({localeStrings:{},d3:{width:()=>e(window).width(),height:()=>e(window).height()}}),defaultTree={name:"All",children:[]},pivotDataToTreemapInput=t=>t.getRowKeys().map(e=>({path:e.map(String),value:t.getAggregator(e,[]).value()})),addSubtreeToTree=(e,t,a)=>{if(0===t.length)return{...e,value:a};let[r,...i]=t,n=e.children.findIndex(e=>e.name===r);t=-1!==n?e.children.map((e,t)=>t===n?addSubtreeToTree(e,i,a):e):[...e.children,addSubtreeToTree({name:r,children:[]},i,a)];return{...e,children:t}},createTreeMap=(e={name:"All",children:[]},t)=>t.reduce((e,t)=>addSubtreeToTree(e,t.path,t.value),e),renderTreeMap=(e,t,a)=>{let r=d3.scaleSequential([8,0],d3.interpolateMagma);e=e;e=d3.treemap().size([t,a]).paddingOuter(3).paddingTop(19).paddingInner(1).round(!0)(d3.hierarchy(e).sum(e=>e.value).sort((e,t)=>t.value-e.value)),t=d3.create("svg").attr("width",t).attr("height",a).attr("viewBox",[0,0,t,a]).attr("style","max-width: 100%; height: auto; overflow: visible; font: 10px sans-serif;"),a=t.selectAll("g").data(d3.group(e,e=>e.height)).join("g").selectAll("g").data(e=>e[1]).join("g").attr("transform",e=>`translate(${e.x0},${e.y0})`);let i=d3.format(",d");return a.append("title").text(e=>e.ancestors().reverse().map(e=>e.data.name).join("/")+`
`+i(e.value)),a.append("rect").attr("id",e=>e.nodeUid=uniqueId()).attr("fill",e=>r(e.height)).attr("width",e=>e.x1-e.x0).attr("height",e=>e.y1-e.y0),a.append("clipPath").attr("id",e=>e.clipUid=uniqueId()).append("use").attr("xlink:href",e=>"#"+e.nodeUid),a.append("text").attr("clip-path",e=>`url(#${e.clipUid})`).selectAll("tspan").data(e=>e.data.name.split(/(?=[A-Z][^A-Z])/g).concat(i(e.value))).join("tspan").attr("fill-opacity",(e,t,a)=>t===a.length-1?.7:null).text(e=>e),a.filter(e=>e.children).selectAll("tspan").attr("dx",3).attr("y",13),a.filter(e=>!e.children).selectAll("tspan").attr("x",3).attr("y",(e,t,a)=>.3*(t===a.length-1)+1.1+.9*t+"em"),t.node()},renderTreeMapUI=e=>{var t=$("<div>").css({width:"100%",height:"100%"});return t.append(e),t},pivotDataToTreemap=(e,t)=>{e=pivotDataToTreemapInput(e),e=createTreeMap(defaultTree,e);return renderTreeMap(e,t.d3.width(),t.d3.height())},makeTreeMap=()=>{let a=initializeDefaults($);return(e,t)=>{t=mergeOptions(a,t),e=pivotDataToTreemap(e,t);return renderTreeMapUI(e)}},createD3Renderers=e=>({TreeMap:makeTreeMap(e)});callWithJQuery(e=>{e.pivotUtilities.d3_renderers=createD3Renderers(e)});