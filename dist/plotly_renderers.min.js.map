{"version":3,"sources":["plotly_renderers.coffee"],"names":["pivotModule","$","Plotly","makePlotlyChart","traceOptions","layoutOptions","transpose","pivotData","opts","columns","d","data","datumKeys","fullAggName","i","rowKeys","rows","titleText","traceKeys","extend","localeStrings","vs","by","plotly","plotlyConfig","getRowKeys","colKeys","getColKeys","length","push","aggregatorName","valAttrs","join","map","traceKey","datumKey","trace","val","values","labels","j","len","parseFloat","getAggregator","value","isFinite","name","type","x","y","groupByTitle","hAxisTitle","rowAttrs","colAttrs","layout","title","hovermode","width","window","innerWidth","height","innerHeight","Math","ceil","sqrt","grid","domain","row","floor","column","showlegend","xaxis","automargin","yaxis","result","appendTo","newPlot","detach","pivotUtilities","plotly_renderers","Horizontal Bar Chart","orientation","barmode","Horizontal Stacked Bar Chart","Bar Chart","Stacked Bar Chart","Line Chart","Area Chart","stackgroup","Scatter Chart","colKey","k","len1","renderArea","rowKey","v","text","mode","style","remove","Multiple Pie Chart","scalegroup","hoverinfo","textinfo","exports","module","require","define","amd","jQuery"],"mappings":"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","file":"plotly_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\"), require(\"plotly.js\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\", \"plotly.js\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery, Plotly\n\ncallWithJQuery ($, Plotly) ->\n\n    makePlotlyChart = (traceOptions = {}, layoutOptions = {}, transpose = false) ->\n        (pivotData, opts) ->\n            defaults =\n                localeStrings: {vs: \"vs\", by: \"by\"}\n                plotly: {}\n                plotlyConfig: {}\n\n            opts = $.extend(true, {}, defaults, opts)\n\n            rowKeys = pivotData.getRowKeys()\n            colKeys = pivotData.getColKeys()\n            traceKeys = if transpose then colKeys else rowKeys\n            traceKeys.push([]) if traceKeys.length == 0\n            datumKeys = if transpose then rowKeys else colKeys\n            datumKeys.push([]) if datumKeys.length == 0\n\n            fullAggName = pivotData.aggregatorName\n            if pivotData.valAttrs.length\n                fullAggName += \"(#{pivotData.valAttrs.join(\", \")})\"\n\n            data = traceKeys.map (traceKey) ->\n                values = []\n                labels = []\n                for datumKey in datumKeys\n                    val = parseFloat(pivotData.getAggregator(\n                        if transpose then datumKey else traceKey,\n                        if transpose then traceKey else datumKey\n                    ).value())\n                    values.push(if isFinite(val) then val else null)\n                    labels.push(datumKey.join('-') || ' ')\n\n                trace = {name: traceKey.join('-') || fullAggName}\n                if traceOptions.type == \"pie\"\n                    trace.values = values\n                    trace.labels = if labels.length > 1 then labels else [fullAggName]\n                else\n                    trace.x = if transpose then values else labels\n                    trace.y = if transpose then labels else values\n                return $.extend(trace, traceOptions)\n\n            if transpose\n                hAxisTitle = pivotData.rowAttrs.join(\"-\")\n                groupByTitle = pivotData.colAttrs.join(\"-\")\n            else\n                hAxisTitle = pivotData.colAttrs.join(\"-\")\n                groupByTitle = pivotData.rowAttrs.join(\"-\")\n            titleText = fullAggName\n            titleText += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            titleText += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n\n            layout =\n                title: titleText\n                hovermode: 'closest'\n                width: window.innerWidth / 1.4\n                height: window.innerHeight / 1.4 - 50\n\n            if traceOptions.type == 'pie'\n                columns = Math.ceil(Math.sqrt(data.length))\n                rows = Math.ceil(data.length / columns)\n                layout.grid = {columns, rows}\n                for i, d of data\n                    d.domain = {\n                        row: Math.floor(i / columns),\n                        column: i - columns * Math.floor(i / columns),\n                    }\n                    if data.length > 1\n                        d.title = d.name\n                layout.showlegend = false if data[0].labels.length == 1\n            else\n                layout.xaxis =\n                    title: if transpose then fullAggName else null\n                    automargin: true\n                layout.yaxis =\n                    title: if transpose then null else fullAggName\n                    automargin: true\n\n\n            result = $(\"<div>\").appendTo $(\"body\")\n            Plotly.newPlot(result[0], data, $.extend(layout, layoutOptions, opts.plotly), opts.plotlyConfig)\n            return result.detach()\n\n    makePlotlyScatterChart = -> (pivotData, opts) ->\n        defaults =\n            localeStrings: {vs: \"vs\", by: \"by\"}\n            plotly: {}\n            plotlyConfig: {}\n\n        opts = $.extend(true, {}, defaults, opts)\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n\n        data = {x: [], y: [], text: [], type: 'scatter', mode: 'markers'}\n\n        for rowKey in rowKeys\n            for colKey in colKeys\n                v = pivotData.getAggregator(rowKey, colKey).value()\n                if v?\n                    data.x.push(colKey.join('-'))\n                    data.y.push(rowKey.join('-'))\n                    data.text.push(v)\n\n        layout = {\n            title: pivotData.rowAttrs.join(\"-\") + ' vs ' + pivotData.colAttrs.join(\"-\")\n            hovermode: 'closest',\n            xaxis: {title: pivotData.colAttrs.join('-'), automargin: true},\n            yaxis: {title: pivotData.rowAttrs.join('-'), automargin: true},\n            width: window.innerWidth / 1.5,\n            height: window.innerHeight / 1.4 - 50\n        }\n\n        renderArea = $(\"<div>\", style: \"display:none;\").appendTo $(\"body\")\n        result = $(\"<div>\").appendTo renderArea\n        Plotly.newPlot(result[0], [data], $.extend(layout, opts.plotly), opts.plotlyConfig)\n        result.detach()\n        renderArea.remove()\n        return result\n\n    $.pivotUtilities.plotly_renderers =\n        \"Horizontal Bar Chart\": makePlotlyChart({type: 'bar', orientation: 'h'},\n            {barmode: 'group'}, true)\n        \"Horizontal Stacked Bar Chart\": makePlotlyChart({type: 'bar', orientation: 'h'},\n            {barmode: 'relative'}, true)\n        \"Bar Chart\": makePlotlyChart({type: 'bar'}, {barmode: 'group'})\n        \"Stacked Bar Chart\": makePlotlyChart({type: 'bar'}, {barmode: 'relative'})\n        \"Line Chart\": makePlotlyChart()\n        \"Area Chart\": makePlotlyChart({stackgroup: 1})\n        \"Scatter Chart\": makePlotlyScatterChart()\n        'Multiple Pie Chart': makePlotlyChart(\n            {type: 'pie', scalegroup: 1, hoverinfo: 'label+value', textinfo: 'none'},\n            {}, true)\n"]}