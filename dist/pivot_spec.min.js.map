{"version":3,"sources":["pivot_spec.coffee"],"names":["fixtureData","raggedFixtureData","name","colour","age","gender","describe","table","beforeEach","done","$","pivotUI","onRefresh","it","expect","find","length","toBe","val","text","join","data","rows","cols","aggregatorName","vals","rendererName","pivot","aggregators","derivers","sortAs","pivotUtilities","aggregator","filter","record","derivedAttributes","birthyear","dateFormat","trialbins","bin","sorters","attr","received_PivotData","count2x","push","this","value","format","x","renderer","a","b","addClass","greeting","rendererOptions","agg","getAggregator","sumOverSumOpts","pd","PivotData","tableInput","getRowKeys","toEqual","getColKeys","c","j","len1","r","ref1","numNotNull","numNull","ref","i","len","records","forEachMatchingRecord","getVal","tpl","aggregatorTemplates","count","countUnique","listUnique","average","sum","min","max","first","last","median","quantile","var","stdev","sumOverSum","naturalSort","sortedArr","slice","sort","numberFormat","nf","scaler","suffix","thousandsSep","decimalSep","prefix","digitsAfterDecimal","df","Date","binner","toBeNaN"],"mappings":"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","file":"pivot_spec.min.js","sourcesContent":["fixtureData = [\n    [\"name\",    \"gender\",   \"colour\",    \"birthday\",     \"trials\",   \"successes\"],\n    [\"Nick\",    \"male\",     \"blue\",      \"1982-11-07\",   103,        12],\n    [\"Jane\",    \"female\",   \"red\",       \"1982-11-08\",   95,         25],\n    [\"John\",    \"male\",     \"blue\",      \"1982-12-08\",   112,        30],\n    [\"Carol\",   \"female\",   \"yellow\",    \"1983-12-08\",   102,        14]\n]\n\nraggedFixtureData = [\n    {name: \"Nick\", \"colour\": \"red\", \"age\": 34}\n    {name: \"Jane\", \"gender\": \"female\"}\n    {name: \"John\", \"gender\": \"male\", \"age\": 12}\n    {name: \"Jim\", \"gender\": null, \"age\": 12}\n]\n\ndescribe \"$.pivotUI()\", ->\n    describe \"with no rows/cols, default count aggregator, default TableRenderer\",  ->\n        table = null\n\n        beforeEach (done) ->\n            table = $(\"<div>\").pivotUI fixtureData, onRefresh: done\n        it \"has all the basic UI elements\", (done) ->\n            expect table.find(\"td.pvtAxisContainer\").length\n            .toBe  3\n            expect table.find(\"td.pvtRendererArea\").length\n            .toBe  1\n            expect table.find(\"td.pvtVals\").length\n            .toBe  1\n            expect table.find(\"select.pvtRenderer\").length\n            .toBe  1\n            expect table.find(\"select.pvtAggregator\").length\n            .toBe  1\n            expect table.find(\"span.pvtAttr\").length\n            .toBe  6\n            done()\n\n        it \"reflects its inputs\", (done) ->\n            expect table.find(\"td.pvtUnused span.pvtAttr\").length\n            .toBe  6\n            expect table.find(\"select.pvtRenderer\").val()\n            .toBe  \"Table\"\n            expect table.find(\"select.pvtAggregator\").val()\n            .toBe  \"Count\"\n            done()\n\n        it \"renders a table\", (done) ->\n            expect table.find(\"table.pvtTable\").length\n            .toBe  1\n            done()\n\n\n        describe \"its renderer output\", ->\n            it \"has the correct type and number of cells\", (done) ->\n                expect table.find(\"th.pvtTotalLabel\").length\n                .toBe  1\n                expect table.find(\"td.pvtGrandTotal\").length\n                .toBe  1\n                done()\n\n            it \"has the correct textual representation\", (done) ->\n                expect table.find(\"table.pvtTable\").text()\n                .toBe [\"Totals\", \"4\"].join(\"\")\n                done()\n\n            it \"has a correct grand total with data value\", (done) ->\n                expect table.find(\"td.pvtGrandTotal\").text()\n                .toBe  \"4\"\n                expect table.find(\"td.pvtGrandTotal\").data(\"value\")\n                .toBe  4\n                done()\n\n    describe \"with rows/cols, sum-over-sum aggregator, Heatmap renderer\",  ->\n        table = null\n\n        beforeEach (done) ->\n            table = $(\"<div>\").pivotUI fixtureData,\n                rows: [\"gender\"], cols: [\"colour\"]\n                aggregatorName: \"Sum over Sum\"\n                vals: [\"successes\", \"trials\"]\n                rendererName: \"Heatmap\"\n                onRefresh: done\n\n        it \"has all the basic UI elements\", (done) ->\n            expect table.find(\"td.pvtAxisContainer\").length\n            .toBe  3\n            expect table.find(\"td.pvtRendererArea\").length\n            .toBe  1\n            expect table.find(\"td.pvtVals\").length\n            .toBe  1\n            expect table.find(\"select.pvtRenderer\").length\n            .toBe  1\n            expect table.find(\"select.pvtAggregator\").length\n            .toBe  1\n            expect table.find(\"span.pvtAttr\").length\n            .toBe  6\n            done()\n\n        it \"reflects its inputs\", (done) ->\n            expect table.find(\"td.pvtUnused span.pvtAttr\").length\n            .toBe  4\n            expect table.find(\"td.pvtRows span.pvtAttr\").length\n            .toBe  1\n            expect table.find(\"td.pvtCols span.pvtAttr\").length\n            .toBe  1\n            expect table.find(\"select.pvtRenderer\").val()\n            .toBe  \"Heatmap\"\n            expect table.find(\"select.pvtAggregator\").val()\n            .toBe  \"Sum over Sum\"\n            done()\n\n        it \"renders a table\", (done) ->\n            expect table.find(\"table.pvtTable\").length\n            .toBe  1\n            done()\n\n        describe \"its renderer output\", ->\n            it \"has the correct type and number of cells\", (done) ->\n                expect table.find(\"th.pvtAxisLabel\").length\n                .toBe  2\n                expect table.find(\"th.pvtRowLabel\").length\n                .toBe  2\n                expect table.find(\"th.pvtColLabel\").length\n                .toBe  3\n                expect table.find(\"th.pvtTotalLabel\").length\n                .toBe  2\n                expect table.find(\"td.pvtVal\").length\n                .toBe  6\n                expect table.find(\"td.pvtTotal\").length\n                .toBe  5\n                expect table.find(\"td.pvtGrandTotal\").length\n                .toBe  1\n                done()\n\n            it \"has the correct textual representation\", (done) ->\n                expect table.find(\"table.pvtTable\").text()\n                .toBe [\n                    \"colour\",   \"blue\", \"red\",  \"yellow\",   \"Totals\",\n                    \"gender\",\n                    \"female\",           \"0.26\", \"0.14\",     \"0.20\",\n                    \"male\",     \"0.20\",                     \"0.20\",\n                    \"Totals\",   \"0.20\", \"0.26\", \"0.14\",     \"0.20\"\n                    ].join(\"\")\n                done()\n\n            it \"has a correct spot-checked cell with data value\", (done) ->\n                expect table.find(\"td.col0.row1\").text()\n                .toBe  \"0.20\"\n                expect table.find(\"td.col0.row1\").data(\"value\")\n                .toBe  (12+30)/(103+112)\n                done()\n\n    describe \"with ragged input\",  ->\n        table = $(\"<div>\").pivotUI raggedFixtureData, rows: [\"gender\"], cols: [\"age\"]\n\n        it \"renders a table with the correct textual representation\", ->\n            expect table.find(\"table.pvtTable\").text()\n            .toBe [\n                \"age\",     \"12\",  \"34\",  \"null\",  \"Totals\"\n                \"gender\",\n                \"female\",                 \"1\",    \"1\"\n                \"male\",    \"1\",                   \"1\"\n                \"null\",    \"1\",    \"1\",           \"2\"\n                \"Totals\",  \"2\",    \"1\",   \"1\",    \"4\"\n                ].join(\"\")\n\ndescribe \"$.pivot()\", ->\n\n    describe \"with no rows/cols, default count aggregator, default TableRenderer\",  ->\n        table = $(\"<div>\").pivot fixtureData\n\n        it \"renders a table\", ->\n            expect table.find(\"table.pvtTable\").length\n            .toBe  1\n\n        describe \"its renderer output\", ->\n\n            it \"has the correct textual representation\", ->\n                expect table.find(\"table.pvtTable\").text()\n                .toBe [\"Totals\", \"4\"].join(\"\")\n\n            it \"has a correct grand total with data value\", ->\n                expect table.find(\"td.pvtGrandTotal\").text()\n                .toBe  \"4\"\n                expect table.find(\"td.pvtGrandTotal\").data(\"value\")\n                .toBe  4\n\n    describe \"with rows/cols, sum aggregator, derivedAttributes, filter and sorters\",  ->\n        {sortAs, derivers, aggregators} = $.pivotUtilities\n        table = $(\"<div>\").pivot fixtureData,\n            rows: [\"gender\"], cols: [\"birthyear\"], aggregator: aggregators[\"Sum\"]([\"trialbins\"])\n            filter: (record) -> record.name != \"Nick\"\n            derivedAttributes:\n                birthyear: derivers.dateFormat \"birthday\", \"%y\"\n                trialbins: derivers.bin \"trials\", 10\n            sorters: (attr) ->\n                if attr == \"gender\" then return sortAs([\"male\", \"female\"])\n\n        it \"renders a table with the correct textual representation\", ->\n            expect table.find(\"table.pvtTable\").text()\n            .toBe [\n                \"birthyear\",    \"1982\",     \"1983\",     \"Totals\"\n                \"gender\",\n                \"male\",         \"110.00\",               \"110.00\"\n                \"female\",       \"90.00\",    \"100.00\",   \"190.00\"\n                \"Totals\",       \"200.00\",   \"100.00\",   \"300.00\"\n                ].join(\"\")\n\n    describe \"with rows/cols, fraction-of aggregator\",  ->\n        {aggregators} = $.pivotUtilities\n        table = $(\"<div>\").pivot fixtureData,\n            rows: [\"gender\"]\n            aggregator: aggregators[\"Sum as Fraction of Total\"]([\"trials\"])\n\n        it \"renders a table with the correct textual representation\", ->\n            expect table.find(\"table.pvtTable\").text()\n            .toBe [\n                \"gender\",  \"Totals\"\n                \"female\",  \"47.8%\"\n                \"male\",    \"52.2%\"\n                \"Totals\",  \"100.0%\"\n                ].join(\"\")\n\n    describe \"with rows/cols, custom aggregator, custom renderer with options\",  ->\n        received_PivotData = null\n        received_rendererOptions = null\n\n        table = $(\"<div>\").pivot fixtureData,\n            rows: [\"name\", \"colour\"], cols: [\"trials\", \"successes\"]\n            aggregator: ->\n                count2x: 0\n                push: -> @count2x +=2\n                value: -> @count2x\n                format: (x) -> \"formatted \" + x\n            renderer: (a,b) ->\n                received_PivotData = a\n                received_rendererOptions = b\n                return $(\"<div>\").addClass(b.greeting).text(\"world\")\n            rendererOptions: {greeting:\"hithere\"}\n\n        it \"renders the custom renderer as per options\", ->\n            expect table.find(\"div.hithere\").length\n            .toBe  1\n\n        describe \"its received PivotData object\", ->\n            it \"has a correct grand total value and format for custom aggregator\", ->\n                agg = received_PivotData.getAggregator([],[])\n                val = agg.value()\n                expect(val).toBe 8\n                expect(agg.format(val)).toBe \"formatted 8\"\n\n\n    describe \"with ragged input\",  ->\n        table = $(\"<div>\").pivot raggedFixtureData, rows: [\"gender\"], cols: [\"age\"]\n\n        it \"renders a table with the correct textual representation\", ->\n            expect table.find(\"table.pvtTable\").text()\n            .toBe [\n                \"age\",     \"12\",  \"34\",  \"null\",  \"Totals\"\n                \"gender\",\n                \"female\",                 \"1\",    \"1\"\n                \"male\",    \"1\",                   \"1\"\n                \"null\",    \"1\",    \"1\",           \"2\"\n                \"Totals\",  \"2\",    \"1\",   \"1\",    \"4\"\n                ].join(\"\")\n\ndescribe \"$.pivotUtilities\", ->\n\n    describe \".PivotData()\", ->\n        sumOverSumOpts =\n            aggregator: $.pivotUtilities.aggregators[\"Sum over Sum\"]([\"a\",\"b\"])\n\n        describe \"with no options\", ->\n            aoaInput =  [ [\"a\",\"b\"], [1,2], [3,4] ]\n            pd = new $.pivotUtilities.PivotData aoaInput\n\n            it \"has the correct grand total value\", ->\n                expect pd.getAggregator([],[]).value()\n                .toBe 2\n\n        describe \"with array-of-array input\", ->\n            aoaInput =  [ [\"a\",\"b\"], [1,2], [3,4] ]\n            pd = new $.pivotUtilities.PivotData aoaInput, sumOverSumOpts\n\n            it \"has the correct grand total value\", ->\n                expect pd.getAggregator([],[]).value()\n                .toBe (1+3)/(2+4)\n\n        describe \"with array-of-object input\", ->\n            aosInput =  [ {a:1, b:2}, {a:3, b:4} ]\n            pd = new $.pivotUtilities.PivotData aosInput, sumOverSumOpts\n\n            it \"has the correct grand total value\", ->\n                expect pd.getAggregator([],[]).value()\n                .toBe (1+3)/(2+4)\n\n        describe \"with ragged array-of-object input\", ->\n            raggedAosInput =  [ {a:1}, {b:4}, {a: 3, b: 2} ]\n            pd = new $.pivotUtilities.PivotData raggedAosInput, sumOverSumOpts\n\n            it \"has the correct grand total value\", ->\n                expect pd.getAggregator([],[]).value()\n                .toBe (1+3)/(2+4)\n\n        describe \"with function input\", ->\n            functionInput = (record) ->\n                record a:1, b:2\n                record a:3, b:4\n            pd = new $.pivotUtilities.PivotData functionInput, sumOverSumOpts\n\n            it \"has the correct grand total value\", ->\n                expect pd.getAggregator([],[]).value()\n                .toBe (1+3)/(2+4)\n\n        describe \"with jQuery table element input\", ->\n            tableInput = $ \"\"\"\n                <table>\n                    <thead>\n                        <tr> <th>a</th><th>b</th> </tr>\n                    </thead>\n                    <tbody>\n                        <tr> <td>1</td> <td>2</td> </tr>\n                        <tr> <td>3</td> <td>4</td> </tr>\n                    </tbody>\n                </table>\n                \"\"\"\n            pd = new $.pivotUtilities.PivotData tableInput, sumOverSumOpts\n\n            it \"has the correct grand total value\", ->\n                expect pd.getAggregator([],[]).value()\n                .toBe (1+3)/(2+4)\n\n\n        describe \"with rows/cols\", ->\n            pd = new $.pivotUtilities.PivotData fixtureData,\n                rows: [\"name\", \"colour\"],\n                cols: [\"trials\", \"successes\"]\n\n            it \"has correctly-ordered row keys\", ->\n                expect pd.getRowKeys()\n                .toEqual [ [ 'Carol', 'yellow' ], [ 'Jane', 'red' ], [ 'John', 'blue' ], [ 'Nick', 'blue' ] ]\n\n            it \"has correctly-ordered col keys\", ->\n                expect pd.getColKeys()\n                .toEqual [ [ 95, 25 ], [ 102, 14 ], [ 103, 12 ], [ 112, 30 ] ]\n\n            it \"can be iterated over\", ->\n                numNotNull = 0\n                numNull = 0\n                for r in pd.getRowKeys()\n                    for c in pd.getColKeys()\n                        if pd.getAggregator(r, c).value()?\n                            numNotNull++\n                        else\n                            numNull++\n                expect numNotNull\n                .toBe 4\n                expect numNull\n                .toBe 12\n\n            it \"returns matching records\", ->\n                records = []\n                pd.forEachMatchingRecord gender: \"male\", (x) -> records.push(x.name)\n                expect records\n                .toEqual [\"Nick\", \"John\"]\n\n            it \"has a correct spot-checked aggregator\", ->\n                agg = pd.getAggregator([ 'Carol', 'yellow' ],[ 102, 14 ])\n                val = agg.value()\n                expect(val).toBe 1\n                expect(agg.format(val)).toBe \"1\"\n\n            it \"has a correct grand total aggregator\", ->\n                agg = pd.getAggregator([],[])\n                val = agg.value()\n                expect(val).toBe 4\n                expect(agg.format(val)).toBe \"4\"\n\n    describe \".aggregatorTemplates\", ->\n\n        getVal = (aggregator) ->\n            pd = new $.pivotUtilities.PivotData(fixtureData, {aggregator})\n            return pd.getAggregator([],[]).value()\n        tpl = $.pivotUtilities.aggregatorTemplates\n\n        describe \".count\", ->\n            it \"works\", ->\n                expect getVal(tpl.count()())\n                .toBe 4\n\n        describe \".countUnique\", ->\n            it \"works\", ->\n                expect getVal(tpl.countUnique()(['gender']))\n                .toBe 2\n\n        describe \".listUnique\", ->\n            it \"works\", ->\n                expect getVal(tpl.listUnique()(['gender']))\n                .toBe 'female,male'\n\n        describe \".average\", ->\n            it \"works\", ->\n                expect getVal(tpl.average()(['trials']))\n                .toBe 103\n\n        describe \".sum\", ->\n            it \"works\", ->\n                expect getVal(tpl.sum()(['trials']))\n                .toBe 412\n\n        describe \".min\", ->\n            it \"works\", ->\n                expect getVal(tpl.min()(['trials']))\n                .toBe 95\n\n        describe \".max\", ->\n            it \"works\", ->\n                expect getVal(tpl.max()(['trials']))\n                .toBe 112\n\n        describe \".first\", ->\n            it \"works\", ->\n                expect getVal(tpl.first()(['name']))\n                .toBe 'Carol'\n\n        describe \".last\", ->\n            it \"works\", ->\n                expect getVal(tpl.last()(['name']))\n                .toBe 'Nick'\n\n        describe \".average\", ->\n            it \"works\", ->\n                expect getVal(tpl.average()(['trials']))\n                .toBe 103\n\n        describe \".median\", ->\n            it \"works\", ->\n                expect getVal(tpl.median()(['trials']))\n                .toBe 102.5\n\n        describe \".quantile\", ->\n            it \"works\", ->\n                expect getVal(tpl.quantile(0)(['trials']))\n                .toBe 95\n                expect getVal(tpl.quantile(0.1)(['trials']))\n                .toBe 98.5\n                expect getVal(tpl.quantile(0.25)(['trials']))\n                .toBe 98.5\n                expect getVal(tpl.quantile(1/3)(['trials']))\n                .toBe 102\n                expect getVal(tpl.quantile(1)(['trials']))\n                .toBe 112\n\n        describe \".var\", ->\n            it \"works\", ->\n                expect getVal(tpl.var()(['trials']))\n                .toBe 48.666666666666686\n\n        describe \".stdev\", ->\n            it \"works\", ->\n                expect getVal(tpl.stdev()(['trials']))\n                .toBe 6.976149845485451\n\n        describe \".sumOverSum\", ->\n            it \"works\", ->\n                expect getVal(tpl.sumOverSum()(['successes', 'trials']))\n                .toBe (12+25+30+14)/(95+102+103+112)\n\n    describe \".naturalSort()\", ->\n        naturalSort = $.pivotUtilities.naturalSort\n\n        sortedArr = [\n            null, NaN,\n            -Infinity, '-Infinity', -3, '-3', -2, '-2', -1, '-1',\n            0, '2e-1', 1, '01', '1', 2, '002', '002e0', '02', '2', '2e-0',\n            3, 10, '10', '11', '12', '1e2', '112', Infinity, 'Infinity',\n            '1a', '2a','12a','20a',\n            'A', 'A', 'NaN', 'a', 'a',\n            'a01', 'a012', 'a02', 'a1', 'a2', 'a12', 'a12', 'a21', 'a21',\n            'b', 'c', 'd', 'null'\n        ]\n\n        it \"sorts naturally (null, NaN, numbers & numbery strings, Alphanum for text strings)\", ->\n            expect sortedArr.slice().sort(naturalSort)\n            .toEqual sortedArr\n\n    describe \".sortAs()\", ->\n        sortAs = $.pivotUtilities.sortAs\n\n        it \"sorts with unknown values sorted at the end\", ->\n            expect [5,2,3,4,1].sort sortAs([4,3,2])\n            .toEqual [4,3,2,1,5]\n\n        it \"sorts lowercase after uppercase\", ->\n            expect [\"Ab\",\"aA\",\"aa\",\"ab\"].sort sortAs([\"Ab\",\"Aa\"])\n            .toEqual [\"Ab\",\"ab\",\"aa\",\"aA\"]\n\n    describe \".numberFormat()\", ->\n        numberFormat = $.pivotUtilities.numberFormat\n\n        it \"formats numbers\", ->\n            nf = numberFormat()\n            expect nf 1234567.89123456\n            .toEqual \"1,234,567.89\"\n\n        it \"formats booleans\", ->\n            nf = numberFormat()\n            expect nf true\n            .toEqual \"1.00\"\n\n        it \"formats numbers in strings\", ->\n            nf = numberFormat()\n            expect nf \"1234567.89123456\"\n            .toEqual \"1,234,567.89\"\n\n        it \"doesn't formats strings\", ->\n            nf = numberFormat()\n            expect nf \"hi there\"\n            .toEqual \"\"\n\n        it \"doesn't formats objects\", ->\n            nf = numberFormat()\n            expect nf {a:1}\n            .toEqual \"\"\n\n        it \"formats percentages\", ->\n            nf = numberFormat(scaler: 100, suffix: \"%\")\n            expect nf 0.12345\n            .toEqual \"12.35%\"\n\n        it \"adds separators\", ->\n            nf = numberFormat(thousandsSep: \"a\", decimalSep: \"b\")\n            expect nf 1234567.89123456\n            .toEqual \"1a234a567b89\"\n\n        it \"adds prefixes and suffixes\", ->\n            nf = numberFormat(prefix: \"a\", suffix: \"b\")\n            expect nf 1234567.89123456\n            .toEqual \"a1,234,567.89b\"\n\n        it \"scales and rounds\", ->\n            nf = numberFormat(digitsAfterDecimal: 3, scaler: 1000)\n            expect nf 1234567.89123456\n            .toEqual \"1,234,567,891.235\"\n\n    describe \".derivers\", ->\n        describe \".dateFormat()\", ->\n            df = $.pivotUtilities.derivers.dateFormat \"x\", \"abc % %% %%% %a %y %m %n %d %w %x %H %M %S\", true\n\n            it \"formats date objects\", ->\n                expect df {x: new Date(\"2015-01-02T23:43:11Z\")}\n                .toBe 'abc % %% %%% %a 2015 01 Jan 02 Fri 5 23 43 11'\n\n            it \"formats input parsed by Date.parse()\", ->\n                expect df {x: \"2015-01-02T23:43:11Z\"}\n                .toBe 'abc % %% %%% %a 2015 01 Jan 02 Fri 5 23 43 11'\n\n                expect df {x: \"bla\"}\n                .toBe ''\n\n        describe \".bin()\", ->\n            binner = $.pivotUtilities.derivers.bin \"x\", 10\n\n            it \"bins numbers\", ->\n                expect binner {x: 11}\n                .toBe 10\n\n                expect binner {x: 9}\n                .toBe 0\n\n                expect binner {x: 111}\n                .toBe 110\n\n            it \"bins booleans\", ->\n                expect binner {x: true}\n                .toBe 0\n\n            it \"bins negative numbers\", ->\n                expect binner {x: -12}\n                .toBe -10\n\n            it \"doesn't bin strings\", ->\n                expect binner {x: \"a\"}\n                .toBeNaN()\n\n            it \"doesn't bin objects\", ->\n                expect binner {x: {a:1}}\n                .toBeNaN()\n"]}